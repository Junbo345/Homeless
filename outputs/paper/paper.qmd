---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Junbo Li
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#### Package setup ####

library(tidyverse)
library(here)
library(tinytex)
library(dplyr)
library(tibble)
library(opendatatoronto)
library(janitor)
library(ggplot2)
library(knitr)

# Read data
raw_lead_data <- read_csv(here("inputs/data/raw_data.csv"))
cleaned_data <- read_csv(here("outputs/data/analysis_data.csv"))
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

## Raw data

The data used in here is downloaded from opendattoronto [@citeOpenDataToronto]. Specifically, we used the Shelter System Flow Data
released by Toronto government [@toronto_shelter_data].The data loading, cleaning and analysis process is done by R [@citeR], togehter with packges include tidyverse [@tidy]... This data measures number of people requiring for shelter inside city of Toronto from Jan-2018 till Jun-2024 by each month (actively_homeless). Also, this dataset provides division of age group, refugee status, gender, as well as chronic status to provide further detailed study into the change of composition of homeless people over time. While there are several other dataset including daily shelter occupacancy in opendatatoronto, they do not have the subdivision information such as age or refugee status as this one. 

## Cleaned Data

We dropeed the only missing row corresponding to july-2024. We selected our columns of interest, namely, gender: ('male', 'female', 'transgender_non_binary_or_two_spirit'), total number of homeless people every month ('actively_homeless'), as well as refugee and chronic status in polulation column. In addition, we grouped age group by whether they are suitable for work (age under 24 for early career stage, age25-44 for working age and age above 45 for pre-retirement and retirement age). Finally, we replace the month data by averaged quatered data for better analysis and visualization of a prelonged time period. The cleaned data could be seen in @tbl-cleandata. 

```{r}
#| label: tbl-cleandata
#| echo: false
#| tbl-cap: "cleaned dataset"

cleaned_data |>
  slice(1:5) |>
  kable(
    col.names = c("Time (Quaters)", "Subdivision", "Total people", "Female", "Male", "Other Gender",
                  "Early Career Stage", "Working Age", "Pre-retire and Retire"),
    digits = 0)



```



# Results {#sec-results}

## Overall trend

First, we plot the bar graph of over all trend of homeless people over the pass of the time. In @fig-overall, we observe an slightly increase of total number of homeless people from first quarter 2018 to second quarter of 2024. There is a decrease of homeless population in late 2020-early 2021, but increased quickly after that. 

```{r}
#| label: fig-overall
#| echo: false
#| fig-cap: "Homeless Population Over Quarters"

# Filter the data for 'All Population' group
all_population_data <- subset(cleaned_data, population_group == 'All Population')

# Create the bar graph
ggplot(all_population_data, aes(x = Quarter, y = actively_homeless)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Quarters of a year",
       y = "Total number of homeless people") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```

```{r}
#| label: fig-gender
#| echo: false
#| fig-cap: "Proportion of Active Homeless Population by Gender Over Quarters"

# Filter the data for 'All Population' group
all_population_data <- subset(cleaned_data, population_group == 'All Population')

# Calculate the proportion of each gender
all_population_data <- all_population_data %>%
  mutate(total = gender_female + gender_male + gender_transgender_non_binary_or_two_spirit,
         female_proportion = gender_female / total,
         male_proportion = gender_male / total,
         transgender_proportion = gender_transgender_non_binary_or_two_spirit / total)

# Reshape the data for plotting
proportion_data_long <- all_population_data %>%
  select(Quarter, female_proportion, male_proportion, transgender_proportion) %>%
  gather(key = "Gender", value = "Proportion", -Quarter)

# Rename gender categories for better readability
proportion_data_long$Gender <- recode(proportion_data_long$Gender,
                                      female_proportion = "Female",
                                      male_proportion = "Male",
                                      transgender_proportion = "Other")

# Create the stacked bar graph
ggplot(proportion_data_long, aes(x = Quarter, y = Proportion, fill = Gender)) +
  geom_bar(stat = "identity") +
  labs(x = "Quarters of a year",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "blue", "Other" = "purple"))

```


## Gender trend
Next, we investigate the trend of gender proportion. We plot the proportion of male, female, and Other genders against time in @fig-gender. Even thought there is some flatuations of the proportion of these three gender types, the overall trend is quite stable. The male proportion is around 60% while female proportion around 40% and others around 1%. 

## Chronic trend
@fig-Chronic shows the trend of the proportion of chronic population among all of homeless people over the quarters of a year. Here, according to @chronic, chronic homeless refers to, "People who meet one of the two following criteria, as per the federal definition of chronic homelessness. The person has recorded a minimum of 180 overnight stay in the past year (365 days); or the person has recurrent overnight stays over the past three years with a cumulative duration of at least 546 nights." We can see form the graph that the proportion in chronic homeless increased a lot, from less than 35% in first quarter of 2018 to more than 65% in the second quarter of 2024. 
```{r}
#| label: fig-Chronic
#| echo: false
#| fig-cap: "Proportion of Chronic population to Active Population by Quarter"

# Filter the data for 'All Population' and 'Chronic'
all_population <- subset(cleaned_data, population_group == "All Population")
chronic_population <- subset(cleaned_data, population_group == "Chronic")

# Calculate the proportion of chronic to active population
proportion <- chronic_population$actively_homeless / all_population$actively_homeless

# Create a data frame for plotting
plot_data <- data.frame(Quarter = all_population$Quarter, Proportion = proportion)

# Create a bar graph
ggplot(plot_data, aes(x = Quarter, y = Proportion)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(x = "Quarters", y = "Proportion of Chronic to Active Population") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
## Age trend
@fig-WorkingAge shows the trend of the proportion of different working age statuses among the actively homeless population over the quarters of a year. Here, the working age statuses are categorized into three groups: Early Career Stage, Working Age, and Pre-Retirement and Retirement Age.Even thought the trend is not huge, We can see from the graph that the proportion of the Early Career Stage population  as well as pre-retire and retire have decreased (from 29% and 33% separately in first quarter of 2018 to 25% and 28% in second quarter in 2024). On the other hand, working age proportion increased to 47% in 2024Q2 from 37% in 2018Q1. 
```{r}
#| label: fig-WorkingAge
#| echo: false
#| fig-cap: "Proportion of working age population to Active Population by Quarter"

# Load necessary libraries
library(ggplot2)
library(dplyr)

# Filter the data for 'All Population' group
all_population_data <- subset(cleaned_data, population_group == 'All Population')

# Calculate the proportion of each working age status
all_population_data <- all_population_data %>%
  mutate(total = Early_Career_Stage + Working_Age + Pre_Retirement_and_Retirement_Age,
         early_career_proportion = Early_Career_Stage / total,
         working_age_proportion = Working_Age / total,
         pre_retirement_proportion = Pre_Retirement_and_Retirement_Age / total)

# Reshape the data for plotting
proportion_data_long <- all_population_data %>%
  select(Quarter, early_career_proportion, working_age_proportion, pre_retirement_proportion) %>%
  gather(key = "Age_Status", value = "Proportion", -Quarter)

# Rename age status categories for better readability
proportion_data_long$Age_Status <- recode(proportion_data_long$Age_Status,
                                          early_career_proportion = "Early Career Stage",
                                          working_age_proportion = "Working Age",
                                          pre_retirement_proportion = "Pre-Retirement and Retirement Age")

# Create the stacked bar graph
ggplot(proportion_data_long, aes(x = Quarter, y = Proportion, fill = Age_Status)) +
  geom_bar(stat = "identity") +
  labs(x = "Quarters of a year",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("Early Career Stage" = "blue", 
                               "Working Age" = "pink", 
                               "Pre-Retirement and Retirement Age" = "green"))
```

## Refugee trend
@fig-refugee shows the trend of the proportion of refugees among the actively homeless population over the quarters of a year. We observe a signifiacant decrease of the trend accompanyed by even more signifcant increase. 
```{r}
#| label: fig-refugee
#| echo: false
#| fig-cap: "Proportion of Chronic population to Active Population by Quarter"

# Filter the data for 'All Population' and 'Chronic'
all_population <- subset(cleaned_data, population_group == "All Population")
refu_population <- subset(cleaned_data, population_group == "Refugees")

# Calculate the proportion of chronic to active population
proportion <- refu_population$actively_homeless / all_population$actively_homeless

# Create a data frame for plotting
plot_data <- data.frame(Quarter = all_population$Quarter, Proportion = proportion)

# Create a bar graph
ggplot(plot_data, aes(x = Quarter, y = Proportion)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(x = "Quarters", y = "Proportion of Refugee to Active Population") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


# Discussion
Based on the analysis of results section, we observe that, even though the overall population of homeless people did not incur sgnificant variation in the past six years, its demographics changed a lot. Especially, the proportion of refugees, chronic people as well as working aged people. In the past, City of Toronto has devolted its effort on reducing the number of homeless people, espically through projects of building affordable houses @torontosol. However, our study show that with the change of demographic, the city government should also give its focus on other strategies of reducing homelessness.

First, as the result section points out, the proportion of chronic homeless people nearly doubled in the past six years. Despite its nature of long lasting homeless status, studies have also shown that chronic homelessness is closed associated with chronic illness or mental problems @chronic. As point by another study, average income of people experiencing mental illness and other types of disorders is significantly lower than normal people @Sareen2011. Thus, it is very hard for those people who have already experiencing mental and physical illness to escape homeless. In addition, homeless people would face more severe health problem due to lack of adequate food, discrimination, barriers to health care etc @Sleet2021. A combination of these would become an obvious negative cycle: illness lead to decrease of income, which leads to become homeless, which would further depend illness. What the city government can do, on the other hand, is to increase public health care system, espically focused to those low-income and homeless people. In fact, merely building houses only increased the proportion of chronic homeless people besides its aim is to reduce @house_not.

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage


# References


