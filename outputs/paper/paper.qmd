---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Junbo Li
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

#### Package setup ####

library(tidyverse)
library(here)
library(tinytex)
library(dplyr)
library(tibble)
library(opendatatoronto)
library(janitor)
library(ggplot2)
library(knitr)

# Read data
raw_lead_data <- read_csv(here("inputs/data/raw_data.csv"))
cleaned_data <- read_csv(here("outputs/data/analysis_data.csv"))
```


# Introduction

You can and should cross-reference sections and sub-sections. We use @citeR and @rohan.

The remainder of this paper is structured as follows. @sec-data....



# Data {#sec-data}

## Raw data

The data used in here is downloaded from opendattoronto [@citeOpenDataToronto]. Specifically, we used the Shelter System Flow Data
released by Toronto government [@toronto_shelter_data].The data loading, cleaning and analysis process is done by R [@citeR], togehter with packges include tidyverse [@tidy]... This data measures number of people requiring for shelter inside city of Toronto from Jan-2018 till Jun-2024 by each month (actively_homeless). Also, this dataset provides division of age group, refugee status, gender, as well as chronic status to provide further detailed study into the change of composition of homeless people over time. While there are several other dataset including daily shelter occupacancy in opendatatoronto, they do not have the subdivision information such as age or refugee status as this one. 

## Cleaned Data

We dropeed the only missing row corresponding to july-2024. We selected our columns of interest, namely, gender: ('male', 'female', 'transgender_non_binary_or_two_spirit'), total number of homeless people every month ('actively_homeless'), as well as refugee and chronic status in polulation column. In addition, we grouped age group by whether they are suitable for work (age under 24 for early career stage, age25-44 for working age and age above 45 for pre-retirement and retirement age). Finally, we replace the month data by averaged quatered data for better analysis and visualization of a prelonged time period. The cleaned data could be seen in @tbl-cleandata. 

```{r}
#| label: tbl-cleandata
#| echo: false
#| tbl-cap: "cleaned dataset"

cleaned_data |>
  slice(1:5) |>
  kable(
    col.names = c("Time (Quaters)", "Subdivision", "Total people", "Female", "Male", "Other Gender",
                  "Early Career Stage", "Working Age", "Pre-retire and Retire"),
    digits = 0)



```



# Results {#sec-results}

## Overall trend

First, we plot the bar graph of over all trend of homeless people over the pass of the time. In @fig-overall, we observe an slightly increase of total number of homeless people from first quarter 2018 to second quarter of 2024. There is a decrease of homeless population in late 2020-early 2021, but increased quickly after that. 

```{r}
#| label: fig-overall
#| echo: false
#| fig-cap: "Homeless Population Over Quarters"

# Filter the data for 'All Population' group
all_population_data <- subset(cleaned_data, population_group == 'All Population')

# Create the bar graph
ggplot(all_population_data, aes(x = Quarter, y = actively_homeless)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Quarters of a year",
       y = "Total number of homeless people") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```

```{r}
#| label: fig-gender
#| echo: false
#| fig-cap: "Proportion of Active Homeless Population by Gender Over Quarters"

# Filter the data for 'All Population' group
all_population_data <- subset(cleaned_data, population_group == 'All Population')

# Calculate the proportion of each gender
all_population_data <- all_population_data %>%
  mutate(total = gender_female + gender_male + gender_transgender_non_binary_or_two_spirit,
         female_proportion = gender_female / total,
         male_proportion = gender_male / total,
         transgender_proportion = gender_transgender_non_binary_or_two_spirit / total)

# Reshape the data for plotting
proportion_data_long <- all_population_data %>%
  select(Quarter, female_proportion, male_proportion, transgender_proportion) %>%
  gather(key = "Gender", value = "Proportion", -Quarter)

# Rename gender categories for better readability
proportion_data_long$Gender <- recode(proportion_data_long$Gender,
                                      female_proportion = "Female",
                                      male_proportion = "Male",
                                      transgender_proportion = "Transgender/Non-binary/Two-spirit")

# Create the stacked bar graph
ggplot(proportion_data_long, aes(x = Quarter, y = Proportion, fill = Gender)) +
  geom_bar(stat = "identity") +
  labs(x = "Quarters of a year",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "bottom") +
  scale_fill_manual(values = c("Female" = "pink", "Male" = "blue", "Other" = "purple"))

```


## Gender trend
Next, we investigate the trend of gender proportion. We plot the proportion of male, female, and Other genders against time in @fig-gender. Even thought there is some flatuations of the proportion of these three gender types, the overall trend is quite stable. The male proportion is around 60% while female proportion around 40% and others around 1%. 

## Chronic trend


# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage


# References


